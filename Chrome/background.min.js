chrome.commands.onCommand.addListener(function(command){
    if(command == "searchInYoutube"){
        tubeIt();
    }
    else{
        googIt();
    }
});

chrome.browserAction.onClicked.addListener(googIt)

function tubeIt(){
    searchIt("https://www.youtube.com/results?search_query=");
}

function googIt(){
    searchIt("https://www.google.com/?#q=");
}

function searchIt(url){
    chrome.tabs.getSelected(null,function(tab) {
        var tablink = tab.url;
        
        var vars = [], hash;
        var hashes = tablink.slice(tablink.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++)
        {
          hash = hashes[i].split('=');
          vars.push(hash[0]);
          vars[hash[0]] = hash[1];
        }

        var query = vars['q'];
        if(query != undefined){
            window.open(url+query.replace("+"," "));
        }
    });
}